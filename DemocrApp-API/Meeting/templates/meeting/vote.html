{% extends 'meeting/_base.html' %}

{% load vote_helpers %}

{% block content %}
    {% csrf_token %}
    <h1>{{ vote.name }}</h1>
    {{ vote.description | linebreaks }}
    --------------------------------
    {{ vote.results | safe }}

    {% if vote.method != vote.YES_NO_ABS and vote.state == vote.READY %}
        <ul id="option_list">
            {% for option in vote.option_set.all %}
                <li id="{{ option.id }}">{{ option.name }} {% option_remove_button option %}</li>
            {% endfor %}
        </ul>

        <input type="text" id="additional_option_textbox">
        <button type="button" class="btn btn-sm btn-primary" id="additional_option_submit" onclick="add_option()">add
        </button>
    {% endif %}
{% endblock %}

{% block footerscripts %}
    <script src="/static/js/ballot-management.js"></script>
    <script>
        function add_option() {
            var new_option = $('#additional_option_textbox').val();
            add_candidate_ajax(new_option, {{ meeting.id }}, {{ vote.id }}, function(data) {
                $('#option_list').append("<li id='" + data.id + "'>" + new_option + "<button class='btn btn-sm btn-danger' type='button' onclick='remove_option(" + data.id + ")'>remove</button></li>");
                $('#additional_option_textbox').val('');
            });
        }

        function remove_option(target) {
            remove_candidate_ajax(target, {{ meeting.id }}, {{ vote.id }}, function(data) {
                $('#' + target).remove();
            });
        }
    </script>
{% endblock %}
